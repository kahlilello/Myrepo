--- Cool Code


---- Histogram in PostgresSQL

WITH user_revenues AS (
  SELECT
    -- Select the user ID and revenue
    user_id,
    SUM(m.meal_price*o.order_quantity) AS revenue
  FROM meals AS m
  JOIN orders AS o ON m.meal_id = o.meal_id
  GROUP BY user_id)

SELECT
  -- Return the frequency table of revenues by user
  ROUND(revenue::NUMERIC, -2) AS revenue_100,
  COUNT(DISTINCT user_id) AS users
FROM user_revenues
GROUP BY revenue_100
ORDER BY revenue_100 ASC;
